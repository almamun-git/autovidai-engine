# Deploying Automatic Video Generating AI Engine

This guide shows the simplest way to deploy both backend and frontend without keeping your computer on.

If you just want it online with minimal effort, use Render. This repo already includes a Render blueprint (`render.yaml`) that provisions:
- Backend: Docker Web Service (FastAPI)
- Frontend: Static Site (Vite build), auto-wired to the backend URL

No VM to manage, automatic HTTPS, and one-click redeploys.

---

## Option A — Deploy both on Render (recommended)

1) Push the repository to GitHub (private or public).

2) In Render:
- New → Blueprint → Connect your repo
- Render will detect `render.yaml` and show two services:
  - `autovidai-api` (Web Service, Docker)
  - `autovidai-web` (Static Site)
- Click Apply to create them.

3) Configure backend environment variables (Render Dashboard → Services → `autovidai-api` → Environment):
- `GEMINI_API_KEY`
- `PEXELS_API_KEY`
- `ELEVENLABS_API_KEY`
- `SHOTSTACK_API_KEY`
- Optional: `SHOTSTACK_STAGE` (defaults to `v1`), `RENDER_BACKEND=local` for free local rendering

Defaults:
- The provided blueprint sets `RENDER_BACKEND=local` by default (no Shotstack required).
- To use Shotstack cloud rendering, set `SHOTSTACK_API_KEY` and switch `RENDER_BACKEND=shotstack`.

4) First deploy:
- Open the backend health endpoint: `https://<autovidai-api>.onrender.com/health`
- Open the frontend: `https://<autovidai-web>.onrender.com`

Notes:
- The blueprint already sets `VITE_API_BASE` for the frontend to the backend URL, so no extra config is needed.
- Files generated by the backend are stored at `/app/temp/render_local`. On Render free plan the filesystem is ephemeral and may reset on redeploys.
- If you need persistence between deploys, attach a Render Disk (paid) to the backend and mount it at `/app/temp/render_local`.

---

## Option B — Backend on Render, Frontend on Vercel (optional)

Only do this if you specifically prefer Vercel for the frontend. The code already supports it using `VITE_API_BASE`.

1) Deploy backend on Render (as in Option A) and copy the backend URL, e.g. `https://autovidai-api.onrender.com`.

2) Deploy frontend on Vercel:
- New Project → Import the same repo
- Root Directory: `frontend`
- Build Command: `npm ci && npm run build`
- Output Directory: `dist`
- Environment Variables:
  - `VITE_API_BASE = https://autovidai-api.onrender.com`
- Deploy. The SPA will call the backend using that base URL.

No `vercel.json` is required because the frontend uses `VITE_API_BASE` directly (see `frontend/src/lib/api.ts`). If you prefer proxy-style rewrites instead, you can add a `vercel.json` mapping `/api/*` to the backend URL.

---

## Troubleshooting

- Backend health check: `GET /health` → `{ "status": "ok" }`
- Dependencies check: `GET /health/deps` (set `?live=true` for real API pings)
- CORS: Not needed when the frontend uses `VITE_API_BASE` and calls absolute URLs. If you later serve the frontend from another origin, the backend currently allows `*` origins (FastAPI CORS middleware).
- Static hosting caveat: When not using Docker/Nginx, the `/api` rewrite from `frontend/nginx.conf` is not used. Always rely on `VITE_API_BASE` for static hosts.

---

## Local development recap

- Run with Docker Compose: `docker compose up -d --build` → http://localhost:8080
- Stop: `docker compose down`
- Logs: `docker compose logs -f backend` / `docker compose logs -f web`

See `README.md` for more.
